(function(t){function e(e){for(var r,o,s=e[0],c=e[1],d=e[2],l=0,h=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&h.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);p&&p(e);while(h.length)h.shift()();return i.push.apply(i,d||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={app:0},i=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var d=0;d<s.length;d++)e(s[d]);var p=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"43c8":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);var r=n("2b0e"),a=n("bc3a"),i=n.n(a),o=n("72bf"),s=n.n(o),c=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[t.isGood?e("div",{staticClass:"spinner-wrapper"},[t._m(0)]):t._e()])},d=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"lds-spinner"},[e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div")])}];const p=()=>{const t=window&&window.screen?window.screen.width:1,e=window&&window.screen?window.screen.height:1,n=window&&window.screen?window.screen.colorDepth:16,r=window&&window.navigator?window.navigator.userAgent:"_",a=!(!window||!window.navigator)&&navigator.javaEnabled();let i="ru";window&&window.navigator&&(i=window.navigator.language?window.navigator.language:window.navigator.browserLanguage);const o=(new Date).getTimezoneOffset(),s={version:window.settings.threeDSV2.version,"device.channel":"BRW","device.browserScreenWidth":t,"device.browserScreenHeight":e,"device.browserColorDepth":n,"device.browserUserAgent":r,"device.browserTZ":o,"device.browserLanguage":i,"device.browserJavaEnabled":a,challengeWindowSize:"04"};return s};var l=p;class h{static state(t,e){return r["a"].http.get(`${e}/payment/${t}/continue`)}static async stateToken(t,e){return r["a"].http.get(`${e}/payment/${t}/continue`)}static start(t,e,n){return r["a"].http.post(`${n}/payment/${t}/start`,e)}static threedsV2prepare(t,e){const n=l();return r["a"].http.post(`${e}/payment/${t}/3ds2-prepare/accept`,n)}static getToken(t){return r["a"].http.post(t+"/token")}static decline(t,e){return r["a"].http.post(`${e}/payment/${t}/decline`)}static accept(t,e){return r["a"].http.post(`${e}/payment/${t}/accept`)}static authConfirm(t,e,n){return r["a"].http.post(`${n}/payment/${t}/authentication-confirm`,e)}static authDecline(t,e){return r["a"].http.post(`${e}/payment/${t}/authentication-decline`)}static authRepeat(t,e){return r["a"].http.post(`${e}/payment/${t}/authentication-repeat`)}}const u={OFFER:"offer",RESULT:"result",REDIRECT:"redirect",IN_PROGRESS:"in_progress",AUTHENTICATION:"authentication",THREEDS2PREPARE:"3ds2_prepare",IFRAME:"iframe"};var w={name:"App",data(){return{responseRedirect:null,hiddenIframe:null,isGood:!0,isError:!1,response:null,hiddenFrameWasExist:!1,lastExecutionTime:parseInt(Date.now()/1e3),isStopCheckState:!1,isWasReloaded:!1,iframeWasCreated:!1}},methods:{async createHiddenIframe(t){let e=document.getElementById("app"),n=document.createElement("iframe");n.name="challengeIframe",n.display="none",e.appendChild(n);let r=document.getElementById("challengeForm");t.post?(document.getElementById("threeDSMethodData").value=t.post.threeDSMethodData,r.method="post"):r.method="get",r.action=t.url,r.target="challengeIframe",n.appendChild(r),r.submit(),this.hiddenFrameWasExist=!0,this.hiddenIframe=!0},async checkStatePayment(t,e,n){const{state:r}=t;switch(r){case u.IN_PROGRESS:h.stateToken(e,n).then(async t=>{await this.checkStatePayment(t,e,n)}).catch(t=>{});break;case u.THREEDS2PREPARE:h.threedsV2prepare(e,n).then(async t=>{await this.checkStatePayment(t,e,n)});break;case u.IFRAME:if(this.response=t,"SIZED"!==t.iframeMode||this.iframeWasCreated)clearInterval(window.timer),window.timer=setInterval(async()=>{h.stateToken(this.token,this.portal).then(async t=>{await this.checkStatePayment(t,this.token,this.portal)}).catch(t=>{this.isGood=!1,this.isError=t.data.error})},2e3);else{this.iframeWasCreated=!0;let e=document.createElement("iframe");e.name="ifrm",document.body.appendChild(e);var a=e.contentWindow.document;let n=a.createElement("form");n.setAttribute("method","post"),n.setAttribute("action",t.url);let r=document.createElement("input");r.setAttribute("type","text"),r.setAttribute("name","MD"),r.setAttribute("value",t.post.MD);let i=document.createElement("input");i.setAttribute("type","text"),i.setAttribute("name","TermUrl"),i.setAttribute("value",t.post.TermUrl);let o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("name","creq"),o.setAttribute("value",t.post.creq),n.append(r),n.append(i),n.append(o),n.style.visibility="hidden",a.body.appendChild(n),n.submit(),e.style.width="100%",e.style.height="100%",e.style.position="fixed",e.style.border="none",this.isGood=!1,window.onmessage=t=>{"callback"===t.data&&(setTimeout(()=>{document.getElementsByName("ifrm")[0].remove()},7e3),this.isGood=!0,clearInterval(window.timer),window.timer=setInterval(async()=>{h.stateToken(this.token,this.portal).then(async t=>{await this.checkStatePayment(t,this.token,this.portal)}).catch(t=>{this.isGood=!1,this.isError=t.data.error})},5e3))}}break;case u.REDIRECT:window.scrollTo(0,0),t.post?this.responseRedirect=t:window.location.href=t.url;break}}},async created(){const t=window.location.search,e=new URLSearchParams(t);if(this.token=e.get("token"),this.portal=e.get("portal"),this.isWasReloaded=!!e.get("reload"),!0===window.settings.isDebug){let t=await h.getToken(this.portal);this.token=e.get("token")||t.token;const n=new URL(window.location.href);n.searchParams.set("token",this.token),window.history.replaceState(null,null,n);const r={amount:100};this.isWasReloaded||await h.start(this.token,r,this.portal)}if(!this.token)return this.isGood=!1,void(this.isError="Parameter token is required");if(!this.portal)return this.isGood=!1,void(this.isError="Parameter portal is required");try{h.stateToken(this.token,this.portal).then(async t=>{await this.checkStatePayment(t,this.token,this.portal)}).catch(t=>{this.isGood=!1,this.isError=t.data.error})}catch(n){console.log(n),this.isGood=!1,this.isError=n.data.error}}},m=w,f=(n("d508"),n("2877")),v=Object(f["a"])(m,c,d,!1,null,null,null),y=v.exports;const g=i.a.create({baseURL:""+window.settings.openApi.url,transformRequest:[(t,e)=>(e["content-type"]="application/x-www-form-urlencoded",t)]});g.interceptors.request.use(t=>{if(t&&"object"===typeof t.data)for(let e in t.data)t.data[e]||!1===t.data[e]||0===t.data[e]||delete t.data[e];return t.data=s.a.stringify(t.data),t}),g.interceptors.response.use(t=>t.data,t=>{const{response:e={data:{error:t}}}=t;return Promise.reject(e)}),r["a"].prototype.$http=r["a"].http=g,r["a"].config.productionTip=!1,new r["a"]({render:t=>t(y)}).$mount("#app")},d508:function(t,e,n){"use strict";n("43c8")}});
//# sourceMappingURL=app.6c5356e2.js.map